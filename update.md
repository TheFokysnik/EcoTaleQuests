Ниже — **готовый к отправке PROMPT для Opus 4.6 на русском языке**.
Формат чистый, без моих комментариев. Можно копировать целиком.

---

# PROMPT FOR OPUS 4.6

Ты — senior Java MMO-архитектор, проектирующий production-уровня серверные системы для Hytale.

Мы расширяем существующий серверный плагин **EcoTaleQuests**.
Сейчас в нём уже реализована базовая система квестов с доступом через команду.

Твоя задача — переработать и значительно расширить систему до уровня MMORPG-механики с масштабируемой архитектурой.

Требования:

* SOLID
* Чистая модульная архитектура
* Потокобезопасность
* Масштабируемость (500+ одновременных игроков)
* Без упрощённого “tutorial-стиля” кода

---

## 1) Замена командного доступа на физическую доску квестов

Основной доступ к квестам больше не должен быть через команду.

Необходимо реализовать **размещаемый в мире физический объект “Доска квестов”**.

Требования:

* Администратор может размещать и удалять доски.
* Поддержка нескольких досок.
* Два визуальных варианта:

  * Уличная (на столбе)
  * Внутренняя (настенная)
* При взаимодействии игрока с доской открывается GUI квестов.
* Координаты досок сохраняются персистентно.
* Совместимость с системами защиты регионов.
* Права доступа:

  * ecotale.quests.board.place
  * ecotale.quests.board.remove

Командный доступ можно оставить только для администраторов как резервный способ.

Цель:
Повысить иммерсивность, создать социальные хабы, стимулировать посещение городов.

---

## 2) Система глобальных и ограниченных квестов

Расширить механику доступности квестов.

Типы квестов:

* INDIVIDUAL — индивидуальный (как сейчас)
* GLOBAL_UNIQUE — может принять только один игрок
* LIMITED_SLOTS — ограниченное число одновременных участников

Логика:

* Если GLOBAL_UNIQUE принят — он становится недоступным другим.
* Если игрок провалил или истёк таймер — квест возвращается на доску.
* Если LIMITED_SLOTS достиг лимита — временно блокируется.

Добавить опциональный таймер выполнения:

* Видимый обратный отсчёт в GUI
* Провал по истечении времени
* Корректная обработка релога (grace-период)

Пример конфига:

quest:
type: GLOBAL_UNIQUE
duration_minutes: 30
max_slots: 1

Требуется:

* Потокобезопасная система блокировок
* Центральный QuestAvailabilityManager
* Защита от race conditions

---

## 3) Система рангов квестов (в стиле гильдии искателей приключений)

Ввести иерархию рангов:

E, D, C, B, A, S

Требования:

* У игрока есть ранг.
* Ранг повышается за выполнение квестов или получение rank points.
* Более высокий ранг открывает более сложные квесты.
* Игрок не может принять квест выше своего ранга.
* Возможен штраф за провал (снижение rank points).

Пример конфига:

ranks:
E: { required_points: 0 }
D: { required_points: 100 }
C: { required_points: 300 }
B: { required_points: 700 }
A: { required_points: 1500 }
S: { required_points: 3000 }

GUI должен:

* Показывать текущий ранг игрока
* Группировать квесты по рангу
* Иметь цветовую дифференциацию
* Показывать требуемый ранг в tooltip

---

## 4) GUI-требования

Интерфейс должен быть стилистически совместим с:

* EcoTaleBanking
* EcoTaleRewards

Требования:

* 54 слота
* Фильтры по рангу
* Фильтры по категориям
* Индикаторы заблокированных квестов
* Статус “Занят” для глобальных квестов
* Отображение таймера
* Отсутствие хардкода предметов
* Полная конфигурируемость

---

## 5) Защита от абьюза

Необходимо предотвратить:

* Монополизацию через мультиаккаунты
* Быстрое повторное принятие
* Дюп наград
* Обход таймера через релог

Реализовать:

* Центральный реестр квестов
* Валидацию назначения
* Планировщик истечения времени
* Проверку целостности данных
* Подробное логирование

---

## 6) Хранение данных

Персистентно хранить:

* Активные квесты
* Назначения
* Таймеры
* Прогресс рангов
* Историю выполнения

Поддержка:

* YAML (по умолчанию)
* MySQL (расширенный режим)

Использовать Repository Pattern.

---

## 7) Архитектура

Структура пакетов:

com.ecotale.quests
├── EcoTaleQuestsPlugin
├── board
├── quest
├── rank
├── gui
├── service
├── repository
├── integration
└── util

Обязательные менеджеры:

* QuestBoardManager
* QuestAvailabilityManager
* QuestRankService
* QuestAssignmentService
* TimerService

---

## 8) Интеграция

Система должна корректно интегрироваться с:

* EcoTale economy
* EcoTaleBanking
* EcoTaleRewards
* Будущей RPG-системой уровней

Использовать адаптеры.
Без жёстких зависимостей.

---

## 9) Ожидаемый результат от тебя

Предоставь:

1. Общую архитектуру системы
2. Модели данных
3. State Machine квеста
4. Стратегию потокобезопасных блокировок
5. Пример обработчика взаимодействия с доской
6. Логику системы рангов
7. Пример конфигурации
8. Описание игрового флоу

Проектируй систему как production-уровня MMORPG-механику.
